{% extends "base.html" %}

{% block title %}Избранное - Интернет-магазин{% endblock %}

{% block content %}
<div class="container">
    <h2>Избранные товары</h2>
    
    {% if products %}
        <div class="products-grid">
            {% for product in products %}
                {% set category_label = (product.category or 'Разное')|capitalize %}
                {% set stock_value = product.stock or 0 %}
                <div class="product-card" data-url="{{ url_for('product', product_id=product.id) }}">
                    <div class="product-card-header">
                        <span class="product-badge">{{ category_label }}</span>
                        <form method="POST" action="{{ url_for('remove_from_favorites') }}" class="card-interactive">
                            <input type="hidden" name="product_id" value="{{ product.id }}">
                            <button type="submit" class="favorite-toggle is-active" title="Удалить из избранного" aria-label="Удалить из избранного">
                                ✕
                            </button>
                        </form>
                    </div>
                    <div class="product-card-image">
                        <img src="{{ image_url(product.image) }}" alt="{{ product.name }}">
                    </div>
                    <div class="product-card-body">
                        <h3 class="product-name">
                            <a href="{{ url_for('product', product_id=product.id) }}" class="card-interactive">{{ product.name }}</a>
                        </h3>
                        <p class="product-description">{{ product.description or 'Описание появится в ближайшее время' }}</p>
                        <div class="product-meta">
                            <div class="product-price">{{ "%.2f"|format(product.price) }} ₽</div>
                            <div class="product-stock{% if stock_value <= 3 %} low-stock{% endif %}">
                                {% if stock_value > 0 %}
                                    В наличии: {{ stock_value }} шт.
                                {% else %}
                                    Предзаказ
                                {% endif %}
                            </div>
                        </div>
                        <div class="product-card-footer">
                            <form method="POST" action="{{ url_for('add_to_cart') }}" class="card-interactive">
                                <input type="hidden" name="product_id" value="{{ product.id }}">
                                <input type="hidden" name="quantity" value="1">
                                <button type="submit" class="btn btn-primary cart-pill">В корзину</button>
                            </form>
                            <a href="{{ url_for('product', product_id=product.id) }}" class="btn btn-outline btn-small card-interactive">Подробнее</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <p>У вас пока нет избранных товаров</p>
            <a href="{{ url_for('index') }}" class="btn btn-primary">Перейти к покупкам</a>
        </div>
    {% endif %}
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.product-card').forEach(function(card) {
        card.addEventListener('click', function() {
            var url = card.getAttribute('data-url');
            if (url) {
                window.location.href = url;
            }
        });
    });
    document.querySelectorAll('.card-interactive').forEach(function(element) {
        element.addEventListener('click', function(event) {
            event.stopPropagation();
        });
    });
});
</script>
{% endblock %}

